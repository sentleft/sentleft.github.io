<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<title>Document</title>
	<style type="text/css">	
	html,body{
		width: 100%;
		height: 100%;
		margin: 0;padding: 0
	}
	canvas{
		vertical-align: top;
	}
	</style>
</head>
<body>
	<canvas></canvas>
</body>
<script type="text/javascript" src='js/bg.js'></script>
<script type="text/javascript" src='js/hero.js'></script>
<script type="text/javascript" src='js/bullet.js'></script>
<script type="text/javascript" src='js/foe.js'></script>
<script type="text/javascript">
var canvas = document.querySelector('canvas');
canvas.width = document.documentElement.clientWidth;
canvas.height = document.documentElement.clientHeight;
var ctx = canvas.getContext('2d');
var arr = ['bg.png','hero_fly_1.png','hero_fly_2.png','bullet1.png','enemy1_fly_1.png','enemy1_blowup_1.png','enemy1_blowup_2.png','enemy1_blowup_3.png','enemy1_blowup_4.png'];

var oArr = [];//存放图片对象
loading(arr);
function loading(arr) {
	var index = 0;
	for (var i = 0; i < arr.length; i++) {
		var img = new Image();
		oArr.push(img);//保存所有图片对象
		img.src = "images/"+arr[i];
		img.onload = function () {
			index++;
			if (index==arr.length) {
				//加载完所有图片就调用开始游戏函数
				start()
			}
		}
	}
}

function start() {
	var oBg = new Bg(320,568);//背景
	var oHero = new Hero(66,82);//玩家飞机
	var oBt = new Bullet(6,14);//子弹
	var oFoe = new Foe(34,24);

	step();//执行动画函数
	function step() {
		ctx.clearRect(0,0,canvas.width,canvas.height)
		oBg.draw();
		oHero.draw(oFoe);
		oBt.draw(oHero,oFoe);
		oFoe.draw();
		requestAnimationFrame(step);
	}
	//拖拽玩具飞机
	var dx = 0,dy = 0;
	canvas.addEventListener("touchstart",function (e) {
		dx = e.touches[0].clientX - oHero.x;
		dy = e.touches[0].clientY - oHero.y;
	})
	canvas.addEventListener("touchmove",function (e) {
		var x = e.touches[0].clientX - dx;
		var y = e.touches[0].clientY - dy;

		if (x<0) {
			x = 0;
			dx = e.touches[0].clientX - oHero.x;
		}else if(x>canvas.width-oHero.w){
			x=canvas.width-oHero.w
			dx = e.touches[0].clientX - oHero.x;
		}
		if (y<0) {
			y = 0
			dy = e.touches[0].clientY - oHero.y;
		}else if(y>canvas.height-oHero.h){
			y = canvas.height - oHero.h;
			dy = e.touches[0].clientY - oHero.y;
		}

		oHero.x = x;
		oHero.y = y;
	})
}









</script>
</html>




